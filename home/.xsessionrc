#! /usr/bin/env bash

export DISPLAY=":0"

# local .desktop files
export XDG_DATA_DIRS=${XDG_DATA_DIRS}:${HOME}/local/share
export PATH=${PATH}:${HOME}/local/bin

function say {
  echo "${0}: $*"
  logger "${0}: $*"
}

say "Looking for devices on ${DISPLAY} ..."


#
#  configure my thinkpad keyboards
#
#  https://www.topbug.net/blog/2017/02/23/enable-natural-scrolling-for-trackpads-using-libinput/
#  http://www.thinkwiki.org/wiki/How_to_configure_the_TrackPoint#Configuration_using_xinput
#
for device_name in "ThinkPad Compact USB Keyboard" "ThinkPad Compact Bluetooth Keyboard with TrackPoint" "TPPS/2 IBM TrackPoint" ; do
  if xinput list | egrep "${device_name}.*pointer" > /dev/null ; then
    kbid=$(xinput list | egrep "${device_name}.*pointer" | cut -f2 | cut -d= -f2)
    say "Configuring '${device_name}' (${kbid})"

    # disable middle-click paste
    xinput set-button-map ${kbid} 1 0 3 4 5

    # use natural scrolling
    xinput set-prop ${kbid} "libinput Natural Scrolling Enabled" 1

    # set acceleration (calibrated manually - what feels good)
    xinput set-prop ${kbid} "libinput Accel Speed" 0.2
  fi
done

#
#  configure mouse scroll
#
for device_name in "Microsoft Microsoft 3-Button Mouse" ; do
  if xinput list | egrep "${device_name}.*pointer" > /dev/null ; then
    kbid=$(xinput list | egrep "${device_name}.*pointer" | cut -f2 | cut -d= -f2)
    say "Configuring '${device_name}' (${kbid})"

    # use natural scrolling
    xinput set-prop ${kbid} "libinput Natural Scrolling Enabled" 1

    # set acceleration (calibrated manually - what feels good)
    xinput set-prop ${kbid} "libinput Accel Speed" 1.0
  fi
done
