#! /usr/bin/env ruby

unless ARGV[0]
  puts "USAGE: #{File.basename(__FILE__)} <ip-addr>"
end

ip_addr = ARGV[0]

puts "divining gateway ..."
ifconfig = `ifconfig`

iface = if ifconfig =~ /usb0/
          "usb0"
        elsif ifconfig =~ /eth1/
          "eth1"
        elsif ifconfig =~ /wlan0/
          "wlan0"
        else
          raise "cannot find wireless interface"
        end
addr = `ifconfig #{iface} | fgrep 'inet ' | awk '{print $2}' | cut -d: -f2`.strip
gw = addr.gsub(/\.[0-9]+$/,'.1')

cmd = "sudo route add -host #{ip_addr} gw #{gw} #{iface}"
puts cmd
system cmd
