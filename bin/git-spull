#!/usr/bin/env ruby

pull_args = ARGV

def run cmd
  puts cmd
  system(cmd) || raise("command failed: #{cmd}")
end

run "git stash"
begin
  run "git pull #{ARGV.join(' ')}"
rescue
  run "git reset HEAD"
  run "git stash pop"
  raise $!
end
run "git stash pop"
