#! /usr/bin/env ruby
#
# from http://www.thinkwiki.org/wiki/How_to_enable_the_fingerprint_reader_with_ThinkFinger#Fix_for_the_fingerprint_reader_getting_too_hot
#

idVendor, idProduct = `lsusb | fgrep Fingerprint | cut -d' ' -f6`.chomp.split(':')

devices = `find /sys/devices/*/*/usb* -name level`
devices = devices.split.select do |device|
  status = `cat #{device}`
  status =~ /^on$/
end
devices.each do |device|
  basepath = File.dirname(File.dirname(device))
  vendor = `cat #{basepath}/idVendor`.chomp
  product = `cat #{basepath}/idProduct`.chomp
  if vendor == idVendor && product == idProduct
    cmd = %Q{echo "auto" | sudo tee #{device}}
    puts "=> #{cmd}"
    system cmd
  end
end
